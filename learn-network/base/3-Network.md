### IP
IPv4 用 32位二进制表示，IPv6 用 128位 二进制表示。  

IPv4 下的地址有两种分类方式，一种是5类分法，一种是 `CIDR`。`CIDR` 的出现是为了解决 5类分法的
分配不均的问题。

#### 无类型域间选路(CIDR)
- 将32位一分为二，前半部分代表`网络号`，后半部分代表`主机号`， 形如 `10.100.122.2/24` 就表示`网络号`是前 24 位
- `10.100.122.2/24` 对应的`广播地址`是 `10.100.122.255`， 向这个地址发送数据，`10.100.122`域下的所有机器都可以收到
- `10.100.122.2/24` 对应对应的`子网掩码`是 `255.255.255.0`
- `子网掩码` 与 `IP地址` 做`位与`运算，就是网络号 `10.100.122.0`

##### 根据IP地址算出第一个地址，子网掩码和广播地址
CIDR 形式的地址为 `16.158.165.91`
- 拆分为 `16.158.<101001><01>.91`
- 得到第一个地址为 `16.158.<101001><00>.1`， 即 `16.158.164.1`
- 得到子网掩码为 `255.255.<111111><00>.0`， 即 `255.255.252.0`
- 得到广播地址为 `16.158.<101001><11>.255`， 即 `16.158.167.255`

#### 设置IP
##### 手动设置
###### 使用 net-tools：
```shell script
sudo ifconfig eth1 10.0.0.1/24
sudo ifconfig eth1 up
```
###### 使用 iproute2
```shell script
sudo ip addr add 10.0.0.1/24 dev eth1
sudo ip link set up eth1
```
##### 动态主机配置协议 DHCP(Dynamic Host Configuration Protocol)

### Internet Control Message Protocol (ICMP 互联网控制报文协议) 
- 查询报文
- 差错报文

### 路由器（三层设备）
MAC头和IP头都取下来，然后根据里面的内容和自己的路由算法，修改 IP 头和 MAC 头，然后把包发往转发的设备。  

#### IP 头和 MAC 头变化的方式有两种
##### 转发网关(不改变IP地址)
请求包每经过一个局域网，只改变 `源MAC` 和 `目标MAC`， 不改变 `源IP` 和 `目标IP` 

##### NAT 网关(改变IP地址)

#### 静态路由
手动配置路由表

#### 动态路由
- 距离矢量路由类算法（distance vector routing）， 基于Bellman-Ford算法， 
- 链路状态路由算法 (link state routing), 基于 Dijkstra 算法

##### 基于距离矢量路由算法的BGP （Border Gateway Protocol，外网路由协议)
##### 基于链路状态路由算法的OSPF（Open Shortest Path First，开放式最短路径优先）
广泛应用在数据中心中的协议。由于主要用在数据中心内部，用于路由决策，
因而称为内部网关协议（Interior Gateway Protocol，简称IGP）。
