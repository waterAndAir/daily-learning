### foreach写库的性能缺陷
首先对于每条数据,都要单独去调用一次函数,task 为每个数据都要去执行一次函数
如果有一个partition 100万条数据,调用 100万 次 性能比较差

如果每个数据,都去创建一个数据库连接的话,那么就得创建 100万 次数据库连接

数据库连接的创建和销毁都是非常消耗性能的,即使用了数据库连接池,只是创建了固定数量的数据库连接

还需要多次通过数据库连接发送sql语句,如果有 100万 条数据,就需要发送 100万 次sql语句,同样很消耗性能

### 使用 foreachPartition 算子优化之后
1. 对于写的算子函数,就调用一次,一次传入一个 partition 所有的数据
2. 主要创建或者获取一个数据库连接就可以
3. 只要向数据库发送一次 sql 语句和多组参数即可

在实际生产环境中,都是使用 foreachPartition 操作,但是有一个问题与 mapPartitions 操作一样,如果一个 partition 特别大,可能会出现 OOM 问题