
#### 备库建议设置为 readonly 模式
- 运营类的查询语句会被放到备库上去查，设置为只读可以防止误操作
- 防止切换逻辑有bug，比如切换过程中出现双写，造成主备不一致
- 可以用readonly状态，来判断节点的角色。
#### binlog 类型
- statement： 原始sql， 快，占空间小， 可能导致主备不一致，不推荐使用
- row：记录了完整的事件日志， 占空间多， 保证主备数据一致
- mixed：mysql 会判断 sql 语句是否可能引起主备不一致，如果有可能，就使用 row， 否则使用 statement 格式

#### 主备延迟的原因
- 备库的所在的机器配置差
- 备库读压力大
- 有大事务，比如 一次性delete大量的数据。或在大表上执行了 DDL 语句。
- 备库的并行复制能力弱
##### 双M主备切换的步骤
###### 可靠性优先
- 判断备库B现在的seconds_behind_master，如果小于某个值（比如5秒）继续下一步，否则持续重试这一步；
- 把主库A改成只读状态，即把readonly设置为true；
- 判断备库B的seconds_behind_master的值，直到这个值变成0为止；
- 把备库B改成可读写状态，也就是把readonly 设置为false；
- 把业务请求切到备库B。
###### 可用性优先
- 把备库B改成可读写状态，也就是把readonly 设置为false；
- 把业务请求切到备库B。
- 判断备库B现在的seconds_behind_master，如果小于某个值（比如5秒）继续下一步，否则持续重试这一步；
- 把主库A改成只读状态，即把readonly设置为true；
- 判断备库B的seconds_behind_master的值，直到这个值变成0为止；

