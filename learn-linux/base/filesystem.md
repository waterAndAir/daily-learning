## 文件系统

### 基础概念
#### 文件系统
Linux 世界中一切皆文件，每个文件都有两个数据结构：
- 索引节点(index node): 记录 inode编号、文件大小、访问权限、修改日期、数据的位置等元数据，与文件内容一起存于磁盘
- 目录项(directory entry): 记录文件的名字、索引节点指针以及与其他目录项的关联关系，由内核维护与内存，又称目录项缓存

文件系统会将磁盘格式化为三个区域：  
- 超级块： 存储整个文件系统的状态
- 索引节点区： 存储索引节点
- 数据块区： 存储文件数据  

磁盘读写的最小单位是512B大小的扇区，因为太小影响效率，所以文件系统将 `8个扇区` 组成一个 `4kb`大小的逻辑块作为管理数据的最小单元。  
#### 虚拟文件系统
为了是各种文件系统能在一起同时被使用，Linux 内核在用户进程与文件系统之间引入了统一接口 —— VFS(虚拟文件系统)。  

#### 通用块层
通用块层是处于 VFS 与磁盘驱动中间的一个块设备的抽象层：
- 向上，为文件系统和应用程序提供访问块设备的接口，向下，把异构的磁盘设备抽象为统一的接口
-  为 I/O 请求排队，并通过重新排序、请求合并等方式，提高磁盘读写的效率。

#### 设备层
包括存储设备和相应的驱动程序，负责最终物理设备的 I/O 操作。
##### I/O 排序（调度）算法
- NONE：不对IO请求做处理，常用与虚拟机，这时磁盘的调度由虚拟机负责
- NOOP： 先入先出的基本队列，做一些合并，常见于 SSD
- CFQ: 完全公平调度，为每个进程维护一个 IO 调度队列，支持优先级，按时间片均匀分布IO请求，是有很多系统的模式方式
- DeadLine: 分别为读写创建队列，可以提高机械磁盘的吞吐，确保到达最终期限的请求优先被处理，多用在数据库系统。

### 文件系统IO TODO
- 缓冲与非缓冲I/O：缓冲指的是`标准库内部实现的缓存`。非缓冲I/O直接通过系统调用与文件交互
- 直接与非直接I/O：根据是否使用操作系统的`页缓存`，直接IO会跳过操作系统页缓存，直接与文件系统交互；
- 阻塞与非阻塞I/O：根据应用程序是否阻塞自身运行.非阻塞I/O 不会阻塞当前的线程，随后再通过轮询或者事件通知的形式，获取调用的结果
- 同步与异步I/O：根据是否等待响应结果。异步I/O，指应用程序执行I/O操作后，不等待完成响应，而是继续执行。等到这次 I/O完成后，响应会用事件通知的方式，告诉应用程序。

### IO指标
- 使用率：磁盘处理IO的时间比
- 饱和度：磁盘处理IO的繁忙程度。当饱和度为 100% 时，磁盘无法继续处理新的IO请求
- IOPS: 每秒请求数
- 吞吐量：每秒IO请求大小
- 响应时间：IO请求从发到到收到响应的间隔时间





























