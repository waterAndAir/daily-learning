##### 什么是敏捷？
- 敏捷是一种价值观，一种原则，指导思想，有个段子：卖便签的告诉你，敏捷就是把用户故事写到便签上；问一些敏捷工具开发商，他们告诉你敏捷就是购买他们的服务；如果问卖鞋的，敏捷就是买一双舒服的鞋，以便舒服的进行站立会议
- 目标：最快的速度提供最小可交付的应用，短周期持续迭代持续交付
- 需求：重视业务人员的沟通，建议每天沟通；内部面对面沟通进度，复盘，review
- 对内开发人员：激发个体，提供所需的环境和支援，辅以信任，从而达成目标

##### 什么是函数式编程？
对于 (1 + 2) * 3 - 4
```
# 过程式编程
    var a = 1 + 2;
    var b = a * 3;
    var c = b - 4;
# 函数式编程
var result = subtract(multiply(add(1,2), 3), 4);
# 或
var result = add(1,2).multiply(3).subtract(4)
```
特点：
- 函数是"第一等公民"，可作为变量，参数，返回值
- 只用`表达式`，不用`语句`
- 没有副作用：只返回一个新的值，不修改外部变量
优点：
- 代码简洁，开发快速
- 接近自然语言，易于理解
- 更方便的代码管理，易于做 test
- 易于并发编程，因为函数互不干扰，可以把一组任务放心的放到不同线程去执行


##### 依赖反转(依赖倒置)，依赖注入，控制反转
- 依赖反转(依赖倒置)： 高层B调用底层A，B 依赖 A，但这个A的改动会影响到B，所以抽象出B需要的接口C，B依赖C，A实现C，A 依赖了 C，如果C定义在 B 中，就是A依赖了B，就形成了依赖反转
- 依赖注入（实现控制反转）：对象的依赖不通过自己去new，而是通过外部传入

##### 连接池
- 三个主要接口，init， getConnection， freeConnection
- 检测可用性，自动故障转移
- 维护池状态：连接总数，空闲连接数等等

##### 固定奖品数抽奖，要求概率相同？
- 固定人数：1-100 的随机数，超过库存的不中奖，如果到最后中奖人数不够，则加入特殊逻辑，直接中奖
- 不固定人数：按时间范围散列，距离时间点越近的中奖


##### 高速飞机换引擎-MQ 换服务？
1. 升级消费方，同时订阅新旧主题
2. 升级生产方，由向旧mq发送转为向新mq发送
3. 升级消费方，下线旧消费者


##### 耗时的定时任务怎么优化？
- 同一份数据，减少重复计算次数；
- 分摊CPU计算时间，尽量分散处理（甚至可以实时），而不是集中处理；
- 减少单次计算数据量；


##### 好友关系10亿记录怎么设计？ 
- 关系分为弱关系和强关系，强关系是弱关系的一种特殊形式
- - 弱关系典型表设计：两张表存关系：guanzhu(uid, guanzhu_uid);fensi(uid, fensi_uid);
- - 强关系典型表设计：一张表：friend(uid1, uid2);
- - 最终应该选择弱关系表设计，有利于分库分表（用 uid 分）； 如果使用 friend(uid1, uid2)， 只能选择 uid1 或 uid2 进行分库分表，另一个ID 的查询需要遍历多库多表
- 为了避免 guanzhu 和 fensi 两个表同时插入的损耗,可以异步冗余
- 在可用性与一致性的选择上,一般先保证性能,再保证 `最终一致`
- 最终一致需要有程序进程检查补偿,可以选择增量检查或线上实时检查(比如将 msg1 放入延迟队列 3s，msg2 放入实时队列，如果 msg 1 消费的时候，查不到 msg2，就进入补偿流程)

##### 群离线消息用推模式还是拉模式？
拉模式表设计：
- 群成员表 group_users(group_id, user_id, last_ack_msg_id)
- 群消息表 group_msgs(group_id, sender_id, time, msg_id, msg_detail)

说明：
- 群离线消息一般采用拉取模式，只存一份，不需要为每个用户存储离线群msg_id，只需存储一个最近ack的群消息id/time；
- 为了保证消息可达性，在线消息和离线消息都需要ACK；
- 离线消息过多，可以分群拉取、分页拉取等优化；
- 如果收到重复消息，需要msg_id去重，让用户无感知；

##### 盘口数据频繁变化，100W用户如何实时通知？
- 长连接比短连接性能好很多倍
- 推送量巨大时，推送集群需要与业务集群解耦
- 推送量巨大时，并发推送与批量推送是一个常见的优化手段
- 写入量巨大时，水平切分能够扩容，MQ缓冲可以保护数据库
- 业务复杂，读取量巨大时，加入缓存；定时计算，仅读缓存，不读数据库，能够极大降低数据库压力

##### 高 QPS 的点赞业务怎么做？
计数业务，在数据量大，并发量大的时候，要考虑的一些技术点：
- 用缓存抗读写；
- 服务化，计数系统与业务系统解耦；
- 水平切分扩展吞吐量、数据量、读写量；
- 要考虑扩展性，数据库层面常见的优化有：列扩展，行扩展(着重推荐,用户体系改造就是用的这种方式)两种方式；
- 要考虑批量操作，缓存层面常见的优化有：一个value存储多个业务计数；如 key=msg_id_1 value=100-20-100-1

##### 每秒20W次并发分词检索，架构如何设计？（短文本检索问题）
- ES (耗资源，在已有ES的情况下是首选)
- 分词 + Trie：节点存 item:doc_ids(1,2,3...)
- 分词 + 内存 hash： key=item, value=doc_ids(1,2,3...)


##### 设计短链系统
短链的好处：
- 变短，在限制字数的场景需要，比如短信，微博140限制
- 短链生成的二维码更稀疏
- 原理是 302 重定向

方案：
- 非加密hash，将hash值转化为62进制可以进一步缩短字符串，在判断是否入库的时候,~